<!DOCTYPE html>
<html>
<head>
  <title>OTP Test</title>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-auth-compat.js"></script>
</head>
<body>
  <h2>OTP Login</h2>
  
  <input type="text" id="phone" placeholder="+91XXXXXXXXXX" />
  <div id="recaptcha-container"></div>
  <button onclick="sendOTP()">Send OTP</button>

  <br><br>
  <input type="text" id="otp" placeholder="Enter OTP" />
  <button onclick="verifyOTP()">Verify OTP</button>

  <pre id="result"></pre>

  <script>
const firebaseConfig = {
  apiKey: "AIzaSyBSuuEPfeflIRQlTIkt3Kp9wBlWOe8cqdg",
  authDomain: "alfaauto-abbf9.firebaseapp.com",
  projectId: "alfaauto-abbf9",
  storageBucket: "alfaauto-abbf9.firebasestorage.app",
  messagingSenderId: "701981773368",
  appId: "1:701981773368:web:d684e58b099037b064a0cd",
  measurementId: "G-8RZHDRD3ED"
};

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    // Recaptcha
    window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier("recaptcha-container", {
      size: "normal",
      callback: function(response) {
        console.log("reCAPTCHA verified");
      }
    });

    let confirmationResult = null;

    async function sendOTP() {
      const phone = document.getElementById("phone").value;
      try {
        confirmationResult = await auth.signInWithPhoneNumber(phone, window.recaptchaVerifier);
        document.getElementById("result").innerText = "OTP Sent!";
      } catch (err) {
        document.getElementById("result").innerText = "Error: " + err.message;
      }
    }

    async function verifyOTP() {
      const code = document.getElementById("otp").value;
      try {
        const result = await confirmationResult.confirm(code);
        const idToken = await result.user.getIdToken();

        // Send ID token to backend
        const response = await fetch("http://localhost:5000/api/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ idToken }),
        });

        const data = await response.json();
        document.getElementById("result").innerText = JSON.stringify(data, null, 2);

      } catch (err) {
        document.getElementById("result").innerText = "Verification Error: " + err.message;
      }
    }
  </script>
</body>
</html>
